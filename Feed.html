<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taylor Wiseman RSS Feed Slideshow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f2f5;
            color: #333;
            overflow: hidden;
        }
        
        .slideshow-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }
        
        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            display: flex;
            flex-direction: column;
            padding: 40px;
            background-color: #fff;
        }
        
        .slide.active {
            opacity: 1;
        }
        
        .slide-header {
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 15px;
        }
        
        .slide-title {
            font-size: 3rem;
            color: #2c3e50;
            margin-bottom: 10px;
            line-height: 1.2;
        }
        
        .slide-date {
            font-size: 1.2rem;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        
        .slide-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .slide-image {
            max-height: 50vh;
            object-fit: contain;
            margin-bottom: 20px;
            align-self: center;
        }
        
        .slide-description {
            font-size: 1.8rem;
            line-height: 1.6;
            overflow: hidden;
            flex: 1;
        }
        
        .slide-footer {
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }
        
        .qr-code-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-left: auto;
        }
        
        .qr-code-label {
            font-size: 1.2rem;
            color: #7f8c8d;
            margin-bottom: 5px;
            text-align: center;
        }
        
        .qr-code {
            width: 120px;
            height: 120px;
        }
        
        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 5px;
            background-color: #3498db;
            width: 0%;
            transition: width 0.1s linear;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .loading-text {
            font-size: 2rem;
            margin-top: 20px;
            color: #3498db;
        }
        
        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #fff;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            text-align: center;
        }
        
        .error-title {
            font-size: 2.5rem;
            color: #e74c3c;
            margin-bottom: 20px;
        }
        
        .error-details {
            font-size: 1.5rem;
            max-width: 80%;
            margin-bottom: 30px;
        }
        
        .retry-button {
            padding: 15px 30px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .retry-button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <div class="loading-screen">
        <div class="spinner"></div>
        <div class="loading-text">Loading RSS Feed...</div>
    </div>
    
    <div class="error-message">
        <h2 class="error-title">Error Loading Feed</h2>
        <p class="error-details">We couldn't load the RSS feed. This might be due to network issues or CORS restrictions.</p>
        <button class="retry-button" onclick="location.reload()">Retry</button>
    </div>
    
    <div class="slideshow-container">
        <div class="progress-bar"></div>
    </div>

    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

    <script>
        // Configuration
        const RSS_URL = 'https://taylorwiseman.com/feed';
        const SLIDE_DURATION = 10000; // 10 seconds per slide
        const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
        const QR_CODE_SIZE = 120;
        
        // State variables
        let currentSlideIndex = 0;
        let slides = [];
        let slideInterval;
        let progressInterval;
        let progressBar;
        let slideshowContainer;
        
        // Initialize the slideshow
        document.addEventListener('DOMContentLoaded', () => {
            progressBar = document.querySelector('.progress-bar');
            slideshowContainer = document.querySelector('.slideshow-container');
            
            // Check if QRious library is loaded
            if (typeof QRious === 'undefined') {
                // Fallback to loading the library directly if CDN fails
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js';
                script.onload = fetchRSSFeed;
                script.onerror = () => {
                    document.querySelector('.loading-screen').style.display = 'none';
                    document.querySelector('.error-message').style.display = 'flex';
                    document.querySelector('.error-details').textContent = 'Failed to load QR code generator.';
                };
                document.head.appendChild(script);
            } else {
                fetchRSSFeed();
            }
        });
        
        // Generate QR code for a URL
        function generateQRCode(url, elementId) {
            return new QRious({
                element: document.getElementById(elementId),
                value: url,
                size: QR_CODE_SIZE,
                level: 'H' // High error correction level
            });
        }
        
        // Fetch the RSS feed
        async function fetchRSSFeed() {
            try {
                const response = await fetch(CORS_PROXY + encodeURIComponent(RSS_URL));
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                const data = await response.text();
                parseRSSFeed(data);
            } catch (error) {
                console.error('Error fetching RSS feed:', error);
                document.querySelector('.loading-screen').style.display = 'none';
                document.querySelector('.error-message').style.display = 'flex';
            }
        }
        
        // Parse the RSS feed
        function parseRSSFeed(xmlText) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
            
            const items = xmlDoc.querySelectorAll('item');
            
            if (items.length === 0) {
                document.querySelector('.loading-screen').style.display = 'none';
                document.querySelector('.error-message').style.display = 'flex';
                document.querySelector('.error-details').textContent = 'No items found in the RSS feed.';
                return;
            }
            
            items.forEach(item => {
                const title = item.querySelector('title')?.textContent || 'No Title';
                const link = item.querySelector('link')?.textContent || '#';
                const description = item.querySelector('description')?.textContent || 'No Description';
                const pubDate = item.querySelector('pubDate')?.textContent || '';
                
                // Extract image from content if available
                let imageUrl = null;
                const content = item.querySelector('content\\:encoded')?.textContent || 
                               item.querySelector('encoded')?.textContent || 
                               description;
                
                const imgMatch = content.match(/<img[^>]+src="([^">]+)"/);
                if (imgMatch && imgMatch[1]) {
                    imageUrl = imgMatch[1];
                }
                
                // Clean description (remove HTML tags)
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = description;
                const cleanDescription = tempDiv.textContent || tempDiv.innerText || '';
                
                slides.push({
                    title,
                    link,
                    description: cleanDescription,
                    pubDate: formatDate(pubDate),
                    imageUrl
                });
            });
            
            // Hide loading screen and start slideshow
            document.querySelector('.loading-screen').style.display = 'none';
            createSlideshow();
        }
        
        // Format the date
        function formatDate(dateString) {
            if (!dateString) return '';
            
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch (e) {
                return dateString;
            }
        }
        
        // Create the slideshow
        function createSlideshow() {
            if (slides.length === 0) return;
            
            // Create slide elements
            slides.forEach((slide, index) => {
                const slideElement = document.createElement('div');
                slideElement.className = `slide ${index === 0 ? 'active' : ''}`;
                
                // Create unique ID for QR code canvas
                const qrCodeId = `qr-code-${index}`;
                
                slideElement.innerHTML = `
                    <div class="slide-header">
                        <h2 class="slide-title">${slide.title}</h2>
                        <div class="slide-date">${slide.pubDate}</div>
                    </div>
                    <div class="slide-content">
                        ${slide.imageUrl ? `<img class="slide-image" src="${slide.imageUrl}" alt="${slide.title}" onerror="this.style.display='none'">` : ''}
                        <div class="slide-description">${slide.description}</div>
                    </div>
                    <div class="slide-footer">
                        <div class="qr-code-container">
                            <div class="qr-code-label">Scan to read full article</div>
                            <canvas id="${qrCodeId}" class="qr-code"></canvas>
                        </div>
                    </div>
                `;
                
                slideshowContainer.appendChild(slideElement);
                
                // Generate QR code after the element is added to the DOM
                setTimeout(() => {
                    if (document.getElementById(qrCodeId)) {
                        generateQRCode(slide.link, qrCodeId);
                    }
                }, 0);
            });
            
            // Start the slideshow
            startSlideshow();
        }
        
        // Start the slideshow
        function startSlideshow() {
            // Show the first slide
            showSlide(0);
            
            // Set up the interval to change slides
            slideInterval = setInterval(() => {
                nextSlide();
            }, SLIDE_DURATION);
        }
        
        // Show a specific slide
        function showSlide(index) {
            // Reset progress bar
            if (progressInterval) {
                clearInterval(progressInterval);
            }
            progressBar.style.width = '0%';
            
            // Hide all slides
            const slideElements = document.querySelectorAll('.slide');
            slideElements.forEach(slide => {
                slide.classList.remove('active');
            });
            
            // Show the current slide
            currentSlideIndex = index;
            slideElements[currentSlideIndex].classList.add('active');
            
            // Start progress bar
            let progress = 0;
            progressInterval = setInterval(() => {
                progress += 0.1;
                progressBar.style.width = `${(progress / SLIDE_DURATION) * 100000}%`;
            }, 10);
        }
        
        // Go to the next slide
        function nextSlide() {
            const slideElements = document.querySelectorAll('.slide');
            let nextIndex = currentSlideIndex + 1;
            
            if (nextIndex >= slideElements.length) {
                nextIndex = 0;
            }
            
            showSlide(nextIndex);
        }
        
        // Handle errors for images
        window.addEventListener('error', function(e) {
            if (e.target.tagName === 'IMG') {
                e.target.style.display = 'none';
            }
        }, true);
    </script>
</body>
</html>